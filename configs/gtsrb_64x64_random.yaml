# --------------------------------------------------------------------------
# 实验: GTSRB (64x64) + 随机触发器
# 策略: S2A (最终版)
#       - 64x64 保证图像质量
#       - 使用“结构能量”作为强度参照物
#       - 使用“自适应 Beta”进行智能融合
# 运行: python main_train.py --config ./configs/gtsrb_64x64_random.yaml
# --------------------------------------------------------------------------

device: 'cuda:1'

dataset:
  name: 'gtsrb'
  data_path: './data'
  image_size: 64
  num_classes: 43
  mean: [0.3414, 0.3123, 0.3212]
  std: [0.1671, 0.1670, 0.1771]

train:
  epochs: 200
  batch_size: 128
  optimizer: 'sgd'
  learning_rate: 0.1
  momentum: 0.9
  weight_decay: 5.0e-4
  scheduler: 'cosine'
  num_workers: 32 # 假设新服务器环境健康，设置为高并行数

attack:
  poison_rate: 0.1
  target_label: 0
  wavelet: 'db4'
  subband: ['hl', 'lh', 'hh']


  s2a:
    use_structural_constraint: false

    # [强度控制] 使用“结构能量”作为参照物，这是一个非常好的起点
    energy_ratio_to_structure: 0.1

    # [融合策略控制] 启用自适应 Beta
    adaptive_beta:
      enabled: true
      beta_min: 0.6          # 噪声最强时，beta 的最小值
      beta_max: 0.9          # 噪声最弱时，beta 的最大值
      midpoint_norm: 0.1     # “中等强度”噪声的范数，这是一个普适的良好起点
      steepness: 50.0        # 曲线的陡峭度

    # [SSA窗口] 保持不变
    window_size_1d: 8
    window_size_2d_h: 4
    window_size_2d_w: 4